<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link rel="stylesheet" href="css/CssCadastro.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $("form").on("submit", function(event){
                event.preventDefault();

                var formData = {
                    email: $("#email").val(),
                    senha: $("#senha").val()
                };

                $.ajax({
                    url: "/api/users/login",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(formData),
                    success: function(user){
                        if (user.status === "ativo") {
                            // Armazena o usuário no localStorage
                            localStorage.setItem('user', JSON.stringify(user));
                            // Redireciona para a página inicial se o login for bem-sucedido
                            window.location.href = "/telaADM.html";
                        } else {
                            alert("Falha ao logar, usuário não encontrado.");
                        }
                    },
                    error: function(error){
                        console.log(error);
                        alert("Falha ao logar, usuário não encontrado.");
                    }
                });
                $.ajax({
                    url: "/clientes/login",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(formData),
                    success: function(cliente){
                        if (cliente && cliente.id) {
                            localStorage.setItem('cliente', JSON.stringify(cliente));
                            window.location.href = "/index.html";
                        } else {
                            alert("Falha ao logar, cliente não encontrado.");
                        }
                    },
                    error: function(error){
                        console.log("Erro no login de cliente:", error);
                        alert("Falha ao logar, cliente não encontrado.");
                    }
                });
            });
        });
    </script>
</head>

<style>

</style>
<body>
<div class="login-container">
    <h1 class="login-title">Login</h1>
    <form action="/api/users/login" method="post">
        <div class="form-group">
            <i class="fas fa-envelope"></i>
            <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <i class="fas fa-lock"></i>
            <input type="password" class="form-control" id="senha" name="senha" placeholder="Senha" required>
        </div>
        <button type="submit" class="btn btn-custom btn-block">Entrar</button>
        <h4><a href="cadastroCliente.html" class="forgot-password">Crie Uma Conta</a></h4>
    </form>
</div>
</body>
</html>