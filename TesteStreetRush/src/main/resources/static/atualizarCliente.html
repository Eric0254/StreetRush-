<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Atualização de Cliente</title>
</head>
<body>
<h2>Atualização de Cliente</h2>
<form id="atualizacaoForm">
    <h3>Dados do Cliente</h3>
    <label for="nome">Nome:</label><br>
    <input type="text" id="nome" name="nome" required><br>

    <label for="email">Email:</label><br>
    <input type="email" id="email" name="email" required><br>

    <label for="cpf">CPF:</label><br>
    <input type="text" id="cpf" name="cpf" required><br>

    <label for="senha">Senha:</label><br>
    <input type="password" id="senha" name="senha" required><br>

    <label for="nascimento">Data de Nascimento:</label><br>
    <input type="date" id="nascimento" name="nascimento" required><br>

    <label for="genero">Gênero:</label><br>
    <select id="genero" name="genero" required>
        <option value="masculino">Masculino</option>
        <option value="feminino">Feminino</option>
        <option value="outro">Outro</option>
    </select><br>

    <h3>Endereço de Faturamento</h3>
    <label for="cep">CEP:</label><br>
    <input type="text" id="cep" name="cep" required><br>

    <label for="logradouro">Logradouro:</label><br>
    <input type="text" id="logradouro" name="logradouro" required><br>

    <label for="numero">Número:</label><br>
    <input type="text" id="numero" name="numero" required><br>

    <label for="complemento">Complemento:</label><br>
    <input type="text" id="complemento" name="complemento"><br>

    <label for="bairro">Bairro:</label><br>
    <input type="text" id="bairro" name="bairro" required><br>

    <label for="cidade">Cidade:</label><br>
    <input type="text" id="cidade" name="cidade" required><br>

    <label for="uf">UF:</label><br>
    <input type="text" id="uf" name="uf" required maxlength="2"><br>

    <input type="submit" value="Atualizar">
</form>

<script>
    document.getElementById('atualizacaoForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const clienteId = localStorage.getItem('clienteId');
        if (!clienteId) {
            alert('Cliente não logado ou ID do cliente não encontrado.');
            return;
        }

        const formData = new FormData(event.target);
        const clienteData = {};
        const enderecoData = {};

        formData.forEach((value, key) => {
            if (['cep', 'logradouro', 'numero', 'complemento', 'bairro', 'cidade', 'uf'].includes(key)) {
                enderecoData[key] = value;
            } else {
                clienteData[key] = value;
            }
        });

        fetch(`/clientes/atualizar/${clienteId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                cliente: clienteData,
                enderecoFaturamento: enderecoData
            })
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Erro na atualização');
            })
            .then(data => {
                alert('Cliente atualizado com sucesso!');
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Ocorreu um erro na atualização do cliente.');
            });
    });
</script>
</body>
</html>
